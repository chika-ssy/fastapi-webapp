<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>視聴閲覧記録リスト</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <h1>観た作品リスト</h1>
    <a href="/add-form" class="add-button"> + 新しく追加</a>

    <br><br>

    <!-- 絞り込み + キーワード + 並び替え フォーム -->
    <form action="/" method="get" class="search-form">
        <label for="category">カテゴリで絞り込む：</label>
        <select name="category" id="category">
            <option value="">全て</option>
            <option value="書籍" {% if category == '書籍' %}selected{% endif %}>書籍</option>
            <option value="映画" {% if category == '映画' %}selected{% endif %}>映画</option>
            <option value="ドラマ" {% if category == 'ドラマ' %}selected{% endif %}>ドラマ</option>
        </select>
        <br>

        <label for="keyword">キーワード検索：</label>
        <input type="text" id="keyword" name="keyword" value="{{ keyword or '' }}">
        <br>

        <label for="sort">並び順：</label>
        <select name="sort" id="sort">
            <option value="desc" {% if sort == 'desc' %}selected{% endif %}>新しい順</option>
            <option value="asc" {% if sort == 'asc' %}selected{% endif %}>古い順</option>
        </select>
        <br><br>

        <button type="submit">検索／絞り込み</button>

        <!-- 検索クリアボタン -->
        <a href="/" style="text-decoration: none;">
            <button type="button">クリア</button>
        </a>
    </form>

    <br><hr>
    <!-- 登録内容の記載 -->
    <ul>
        {% for idx, item in items %}
            <li>
                <strong>{{ item.title }}</strong>（{{ item.category }}）<br>
                <div class="comment">{{ item.comment }}</div><br>
                <em>登録日時: {{ item.created_at }}</em><br>
                {% if item.updated_at %}
                    <em>修正日時: {{ item.updated_at }}</em><br>
                {% endif %}

                <div class="comment-buttons">
                    <!-- 編集リンク -->
                    <form action="/edit/{{ idx }}" method="get">
                        <button type="submit">編集</button>
                    </form>
                    <!-- 削除ボタン -->
                    <form action="/delete/{{ idx }}" method="post" onsubmit="return confirmDelete();">
                        <button type="submit">削除</button>
                    </form>
                </div><br>
            </li>
        {% endfor %}
    </ul>

    <!-- 削除確認ダイアログ -->
    <script>
        function confirmDelete() {
            return confirm("本当に削除してよろしいですか？");
        }
    </script>
</body>
</html>
